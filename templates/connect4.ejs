<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            display: inline-block;
            background: radial-gradient(circle at 20% 10%, #1f2937 0%, #0b1220 45%, #060a12 100%);
        }
        .disc {
            width: 46px;
            height: 46px;
            border-radius: 9999px;
            box-shadow: inset 0 2px 8px rgba(255,255,255,0.25), inset 0 -8px 18px rgba(0,0,0,0.35), 0 10px 18px rgba(0,0,0,0.25);
        }
        .disc-empty {
            background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.08), rgba(0,0,0,0.55));
            box-shadow: inset 0 0 0 2px rgba(255,255,255,0.05);
        }
        .disc-red {
            background: radial-gradient(circle at 35% 35%, #ffb3b3, #ef4444 35%, #991b1b 100%);
        }
        .disc-yellow {
            background: radial-gradient(circle at 35% 35%, #fff3b0, #f59e0b 40%, #92400e 100%);
        }
        .last-ring {
            position: absolute;
            inset: -4px;
            border-radius: 9999px;
            border: 3px solid rgba(255,255,255,0.85);
            box-shadow: 0 0 0 3px rgba(59,130,246,0.35), 0 0 18px rgba(59,130,246,0.45);
        }
        .board-shell {
            background: linear-gradient(180deg, #2563eb 0%, #1d4ed8 55%, #1e40af 100%);
            border-radius: 18px;
            box-shadow: inset 0 2px 0 rgba(255,255,255,0.18), 0 20px 40px rgba(0,0,0,0.45);
        }
        .hole {
            width: 54px;
            height: 54px;
            border-radius: 9999px;
            background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.12), rgba(0,0,0,0.75));
            box-shadow: inset 0 10px 22px rgba(0,0,0,0.55), inset 0 -2px 0 rgba(255,255,255,0.05);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .col-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.9);
            letter-spacing: 0.08em;
        }
    </style>
</head>
<body>
    <%
    const cols = columns || 7;
    const rows_ = rows || 6;
    const labels = 'ABCDEFG'.slice(0, cols);
    const last = (last_move !== undefined && last_move !== null) ? last_move : null;
    const boardArr = Array.isArray(board) ? board : Array(cols * rows_).fill('');
    const cellSize = 54;
    const gap = 10;
    const headerW = cols * cellSize + (cols - 1) * gap;
    const outerW = headerW + 64;
    %>

    <div style="width: <%= outerW %>px;">
        <!-- Header -->
        <div class="rounded-t-2xl overflow-hidden">
            <div class="px-6 py-5 text-white" style="background: linear-gradient(90deg, #ef4444 0%, #f59e0b 52%, #0ea5e9 100%);">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="text-3xl">üü°</div>
                        <div>
                            <div class="text-2xl font-bold">ÂõõÂ≠êÊ£ã</div>
                            <div class="text-white/80 text-sm"><%= subtitle || '' %></div>
                        </div>
                    </div>
                    <div class="text-right">
                        <% if (is_finished) { %>
                            <% if (winner === 'R') { %>
                                <div class="text-sm font-semibold bg-white/20 px-3 py-1 rounded-full inline-block">RED ËÉú</div>
                            <% } else if (winner === 'Y') { %>
                                <div class="text-sm font-semibold bg-white/20 px-3 py-1 rounded-full inline-block">YELLOW ËÉú</div>
                            <% } else { %>
                                <div class="text-sm font-semibold bg-white/20 px-3 py-1 rounded-full inline-block">Âπ≥Â±Ä</div>
                            <% } %>
                        <% } else { %>
                            <div class="text-sm font-semibold bg-white/20 px-3 py-1 rounded-full inline-block">
                                <%= current_turn === 'R' ? 'RED ÂõûÂêà' : 'YELLOW ÂõûÂêà' %>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <!-- Board -->
        <div class="px-6 py-5 bg-white rounded-b-2xl shadow-2xl">
            <div class="flex justify-center mb-3">
                <div class="flex gap-[10px]" style="width: <%= headerW %>px;">
                    <% for (let x = 0; x < cols; x++) { %>
                        <div class="col-label flex-1 text-center"><%= labels[x] %></div>
                    <% } %>
                </div>
            </div>

            <div class="board-shell p-4">
                <div class="grid" style="grid-template-columns: repeat(<%= cols %>, <%= cellSize %>px); gap: <%= gap %>px;">
                    <% for (let y = rows_ - 1; y >= 0; y--) { %>
                        <% for (let x = 0; x < cols; x++) { %>
                            <%
                            const idx = y * cols + x;
                            const v = boardArr[idx];
                            const isLast = (last === idx);
                            %>
                            <div class="hole">
                                <% if (v === 'R' || v === 'Y') { %>
                                    <div class="disc <%= v === 'R' ? 'disc-red' : 'disc-yellow' %>" style="position: relative;">
                                        <% if (isLast) { %>
                                            <div class="last-ring"></div>
                                        <% } %>
                                    </div>
                                <% } else { %>
                                    <div class="disc disc-empty"></div>
                                <% } %>
                            </div>
                        <% } %>
                    <% } %>
                </div>
            </div>

            <!-- Players -->
            <div class="mt-5 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="disc disc-red" style="width: 26px; height: 26px;"></div>
                    <div>
                        <div class="text-sm font-semibold text-gray-800"><%= player_red_name || 'RED' %></div>
                        <div class="text-xs text-gray-400">ÂÖàÊâã</div>
                    </div>
                </div>
                <div class="text-xs text-gray-400 text-center">
                    <div>Ê≠•Êï∞: <%= move_count || 0 %></div>
                </div>
                <div class="flex items-center gap-3 flex-row-reverse">
                    <div class="disc disc-yellow" style="width: 26px; height: 26px;"></div>
                    <div class="text-right">
                        <div class="text-sm font-semibold text-gray-800"><%= player_yellow_name || 'Á≠âÂæÖÂä†ÂÖ•' %></div>
                        <div class="text-xs text-gray-400">ÂêéÊâã</div>
                    </div>
                </div>
            </div>

            <div class="mt-4 text-center text-xs text-gray-400">
                Êåá‰ª§: /ÂõõÂ≠êÊ£ã ¬∑ /Âä†ÂÖ•ÂõõÂ≠êÊ£ã ¬∑ /ÂõõÂ≠ê D
            </div>
        </div>
    </div>
</body>
</html>

